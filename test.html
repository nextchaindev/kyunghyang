<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Kyunghyang News</title>
    <!-- <link rel="icon" type="image/x-icon" href="/images/favicon.ico" /> -->
    <meta name="keywords" content="Kyunghyang News" />
    <meta name="description" content="Kyunghyang News" />
    <meta name="author" content="Kyunghyang News" />

    <link rel="stylesheet" href="/styles/color.css" />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/pages/01.css" />
    <link rel="stylesheet" href="/styles/animations/01.animation.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/flickity@2/dist/flickity.min.css"
    />

    <style>
      .zoom1-scrollable {
        position: relative;
        border-bottom: 1px solid #636363;
      }
      h1 {
        color: #fff;
      }
      .zoom1 {
        width: 100%;
        position: fixed;
        right: 0;
        top: 0;
        background: #333;
        height: 100vh;
        overflow: hidden;
      }
      .zoom1-photo {
        width: 100%;
        height: 100%;
        background-image: url(https://www.voicesofyouth.org/sites/voy/files/images/2020-08/finding-sunshine.jpg);
        background-size: cover;
        background-position: center;
      }
    </style>
  </head>
  <body class="kyunghyang-news page01">
    <div class="fullscreen scrollable" style="background: pink"></div>
    <div class="fullscreen scrollable" id="zoom1">
      <div class="zoom1-photo"></div>
    </div>
    <div class="fullscreen scrollable zoom1-scrollable">
      <h1>Section 1</h1>
    </div>
    <div class="fullscreen scrollable zoom1-scrollable">
      <h1>Section 2</h1>
    </div>
    <div class="fullscreen scrollable zoom1-scrollable">
      <h1>Section 3</h1>
    </div>
    <div class="fullscreen scrollable zoom1-scrollable">
      <h1>Section 4</h1>
    </div>
    <div class="fullscreen scrollable" style="background: pink"></div>
    <div class="fullscreen scrollable" style="background: red"></div>
    <div class="fullscreen scrollable" style="background: pink"></div>
    <!-- scripts -->

    <!-- animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script type="module">
      /**
       * global gsap plugins (free)
       * works for animations modules below
       */
      gsap.registerPlugin(ScrollTrigger, TextPlugin, ScrollToPlugin);
    </script>
    <script>
      document.onload = () => {
        document.body.scrollTop(0);
      };

      function goToSection(i) {
        gsap.set("body", { overflowY: "hidden" });
        gsap.to("body", {
          scrollTo: { y: i * innerHeight, autoKill: false },
          duration: 0.6,
          overwrite: true,
          onComplete: () => {
            gsap.set("body", { overflowY: "auto" });
          },
        });
      }

      gsap.utils.toArray(".fullscreen.scrollable").forEach((panel, i) => {
        ScrollTrigger.create({
          trigger: panel,
          onEnter: () => {
            console.log("onEnter", i, document.body.scrollTop);
            goToSection(i);
          },
        });

        ScrollTrigger.create({
          trigger: panel,
          start: "bottom bottom",
          onEnterBack: () => {
            console.log("onEnterBack", i);
            goToSection(i);
          },
        });
      });

      gsap.registerEffect({
        name: "zoom",
        effect: (targets, config) => {
          const vars = { transformOrigin: "0px 0px", ...config },
            { scale, origin } = config,
            clamp = gsap.utils.clamp(-100 * (scale - 1), 0);
          delete vars.origin;
          vars.xPercent = clamp((0.5 - origin[0] * scale) * 100);
          vars.yPercent = clamp((0.5 - origin[1] * scale) * 100);
          vars.overwrite = "auto";
          return gsap.to(targets, vars);
        },
        extendTimeline: true,
        defaults: { origin: [0.5, 0.5], scale: 2 },
      });

      // for each section, we define the zoom data here
      const zoomData = [
        { scale: 1, origin: [0, 0] },
        { scale: 2, origin: [0.5, 0.5] },
        { scale: 2, origin: [0.5, 0.5] },
        { scale: 1, origin: [0, 0] },
      ];

      gsap.utils.toArray(".zoom1-scrollable").forEach((section, index) => {
        const zoom = zoomData[index];
        ScrollTrigger.create({
          trigger: section,
          onToggle(self) {
            if (self.isActive) {
              // if it enters forward or backward
              gsap.effects.zoom(".zoom1-photo", {
                scale: zoom.scale,
                origin: zoom.origin,
                duration: 1,
                ease: "power1.inOut",
              });
            }
          },
          onEnter() {
            if (index === 0) {
              document.getElementById("zoom1").classList.add("zoom1");
            }
          },
          onLeave() {
            if (index === gsap.utils.toArray(".zoom1-scrollable").length - 1) {
              document.getElementById("zoom1").classList.remove("zoom1");
            }
          },
          onEnterBack() {
            if (index === gsap.utils.toArray(".zoom1-scrollable").length - 1) {
              document.getElementById("zoom1").classList.add("zoom1");
            }
          },
          onLeaveBack() {
            if (index === 0) {
              document.getElementById("zoom1").classList.remove("zoom1");
            }
          },
        });
      });
    </script>
  </body>
</html>
